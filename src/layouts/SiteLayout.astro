---
import Layout from './Layout.astro';
import Navbar from '@/components/ui/display/Navbar.astro';
import Button from '@/components/ui/forms/Button.astro';
import Badge from '@/components/ui/feedback/Badge.astro';
import { Icon } from 'astro-icon/components';
import { List, ListItems, Row } from '@/components/ui/layout';
import {
    Command,
    CommandTrigger,
    CommandInput,
    CommandGroups,
    CommandItems,
    CommandFooter,
} from '@/components/ui/overlay/command';

export interface Props {
    title: string;
    description?: string;
}

const { title, description } = Astro.props;

// Navigation links
const navLinks = [
    { label: 'Docs', href: '/docs' },
    { label: 'Components', href: '/docs/components/' },
    { label: 'Todo', href: '/todo' },
];

// Command palette groups
const commandGroups = {
    Pages: [
        { title: 'Home', value: '/', icon: 'home' },
        { title: 'Documentation', value: '/docs', icon: 'book' },
        { title: 'Components', value: '/docs/components', icon: 'layers' },
        { title: 'Todo', value: '/todo', icon: 'check-square' },
    ],
    Actions: [
        { title: 'Toggle Theme', value: 'action:theme', icon: 'palette' },
        { title: 'Toggle Width', value: 'action:width', icon: 'expand' },
    ],
};
---

<Layout title={title} description={description}>
    <div
        class="flex flex-col"
        x-data="{
            theme: $store.theme,
            layout: $store.layout
         }"
        x-init="$store.theme.init(); $store.layout.init()"
    >
        <!-- Site-wide Navbar with Alpine.js dynamic rendering -->
        <Navbar x-data={`{ links: ${JSON.stringify(navLinks)} }`}>
            <a
                slot="brand"
                href="/"
                class="flex items-center pl-4 space-x-2 font-bold text-xl hover:text-primary transition-colors"
            >
                <span>Basis UI</span>
                <Badge size="xs">Beta</Badge>
            </a>

            <Row slot="links">
                <template x-for="link in links" :key="link.href">
                    <Button
                        :href="link.href"
                        variant="ghost"
                        x-text="link.label"
                        size="sm"
                    />
                </template>
            </Row>

            <Row slot="actions">
                <!-- Theme Toggle -->
                <Button
                    variant="ghost"
                    size="icon"
                    x-on:click="$store.theme.toggle()"
                    :title="'Theme: ' + $store.theme.current"
                >
                    <Icon
                        x-show="$store.theme.current === 'light'"
                        name="lucide:sun"
                        class="w-4 h-4"
                    />
                    <Icon
                        x-show="$store.theme.current === 'dark'"
                        name="lucide:moon"
                        class="w-4 h-4"
                    />
                </Button>

                <!-- Width Toggle -->
                <Button
                    variant="ghost"
                    size="icon"
                    x-on:click="$store.layout.toggleWidth()"
                    :title="$store.layout.wide ? 'Collapse Width' : 'Expand Width'"
                >
                    <Icon
                        x-show="!$store.layout.wide"
                        name="lucide:gallery-horizontal"
                        class="w-4 h-4"
                    />
                    <Icon
                        x-show="$store.layout.wide"
                        name="lucide:gallery-horizontal"
                        class="w-4 h-4"
                    />
                </Button>

                <!-- GitHub Icon Button -->
                <Button
                    href="https://github.com/zhengyishen0/basis-ui"
                    target="_blank"
                    variant="ghost"
                    size="icon"
                    title="GitHub"
                >
                    <Icon name="lucide:github" class="w-4 h-4" />
                </Button>

                <!-- Mobile menu button -->
                <Button
                    variant="ghost"
                    size="icon"
                    class="md:hidden"
                    x-on:click="$store.layout.toggleMobileMenu()"
                    data-mobile-menu-trigger
                >
                    <Icon name="lucide:menu" class="w-5 h-5" />
                </Button>
            </Row>
        </Navbar>
    </div>

    <!-- Full-screen glass overlay mobile menu -->
    <div
        x-show="$store.layout.mobileMenuOpen"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-50 md:hidden"
        data-mobile-menu
    >
        <!-- Glass backdrop -->
        <div 
            class="absolute inset-0 bg-background/80 backdrop-blur-lg"
            x-on:click="$store.layout.closeMobileMenu()"
        ></div>
        
        <!-- Menu content -->
        <div 
            class="relative flex flex-col items-center justify-center h-full px-6"
            x-transition:enter="transition ease-out duration-300 delay-100"
            x-transition:enter-start="opacity-0 scale-95"
            x-transition:enter-end="opacity-100 scale-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 scale-100"
            x-transition:leave-end="opacity-0 scale-95"
        >
            <!-- Close button -->
            <Button
                variant="ghost"
                size="icon"
                class="absolute top-8 right-8"
                x-on:click="$store.layout.closeMobileMenu()"
            >
                <Icon name="lucide:x" class="w-6 h-6" />
            </Button>
            
            <!-- Brand -->
            <div class="mb-12">
                <a href="/" class="flex items-center space-x-3 text-3xl font-bold hover:text-primary transition-colors">
                    <span>Basis UI</span>
                    <Badge size="sm">Beta</Badge>
                </a>
            </div>
            
            <!-- Navigation Links -->
            <nav class="flex flex-col items-center space-y-8 mb-12">
                <template x-data={`{ links: ${JSON.stringify(navLinks)} }`} x-for="link in links" :key="link.href">
                    <a 
                        :href="link.href"
                        x-text="link.label"
                        class="text-2xl font-medium text-foreground hover:text-primary transition-colors"
                        x-on:click="$store.layout.closeMobileMenu()"
                    ></a>
                </template>
            </nav>
            
            <!-- Action buttons -->
            <div class="flex items-center space-x-6">
                <!-- Theme Toggle -->
                <Button
                    variant="outline"
                    size="lg"
                    x-on:click="$store.theme.toggle()"
                    :title="'Theme: ' + $store.theme.current"
                >
                    <Icon
                        x-show="$store.theme.current === 'light'"
                        name="lucide:sun"
                        class="w-5 h-5 mr-2"
                    />
                    <Icon
                        x-show="$store.theme.current === 'dark'"
                        name="lucide:moon"
                        class="w-5 h-5 mr-2"
                    />
                    <span x-text="$store.theme.current === 'light' ? 'Dark' : 'Light'">Theme</span>
                </Button>
                
                <!-- GitHub Link -->
                <Button
                    href="https://github.com/zhengyishen0/basis-ui"
                    target="_blank"
                    variant="outline"
                    size="lg"
                    x-on:click="$store.layout.closeMobileMenu()"
                >
                    <Icon name="lucide:github" class="w-5 h-5 mr-2" />
                    <span>GitHub</span>
                </Button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main
        class="flex-1 transition-all duration-300 pt-16"
        x-data
        :class="$store.layout.wide ? '' : 'container mx-auto px-4'"
    >
        <slot />
    </main>
</Layout>
