---
import { cn } from '@/lib/utils';
import { ChevronRight, Slash, Dot } from 'lucide-astro';

export interface Props {
  href?: string;
  separator?: 'chevron' | 'slash' | 'dot' | 'arrow';
  icon?: string;
  class?: string;
  [key: string]: any;
}

const {
  href,
  separator,
  icon,
  class: className,
  ...alpineProps
} = Astro.props;

// Extract x-for, x-key, x-text from alpineProps (like dropdown menu pattern)
const { 'x-for': xFor, 'x-key': xKey, 'x-text': xText, ':href': dynamicHref, ':separator': dynamicSeparator, ...restProps } = alpineProps;

const separatorComponents = {
  chevron: ChevronRight,
  slash: Slash,
  dot: Dot,
  arrow: ChevronRight // fallback
};
---

{xFor ? (
  <template x-for={xFor} x-key={xKey}>
    <div class="contents">
      <li class={cn('flex items-center', className)} {...restProps}>
        <!-- Breadcrumb content - handle null href automatically -->
        <template x-if="item.href && !item.current">
          <a
            :href={dynamicHref || 'item.href'}
            class="flex items-center gap-1.5 no-underline"
          >
            {icon && (
              <svg class="w-4 h-4" x-show={`item.icon === '${icon}'`}>
                <!-- Dynamic icon content -->
              </svg>
            )}
            {xText && <span x-text={xText}></span>}
            <slot />
          </a>
        </template>
        
        <template x-if="!item.href || item.current">
          <span 
            class="text-foreground font-medium flex items-center gap-1.5"
            aria-current="page"
          >
            {icon && (
              <svg class="w-4 h-4" x-show={`item.icon === '${icon}'`}>
                <!-- Dynamic icon content -->
              </svg>
            )}
            {xText && <span x-text={xText}></span>}
            <slot />
          </span>
        </template>
      </li>
      
      <!-- Separator (outside li, auto-hide for last item) -->
      <span 
        class="mx-2 text-muted-foreground flex items-center"
        x-show={dynamicSeparator ? dynamicSeparator : `'${separator}' && (typeof items !== 'undefined' ? index < items.length - 1 : true)`}
      >
        <slot name="separator">
          <ChevronRight class="w-4 h-4" />
        </slot>
      </span>
    </div>
  </template>
) : (
  <div class="contents">
    <li class={cn('flex items-center', className)} {...restProps}>
      <!-- Static breadcrumb content -->
      {href ? (
        <a
          href={href}
          class="flex items-center gap-1.5 no-underline"
        >
          {icon && (
            <svg class="w-4 h-4">
              <!-- Static icon content -->
            </svg>
          )}
          {xText && <span x-text={xText}></span>}
          <slot />
        </a>
      ) : (
        <span 
          class="text-foreground font-medium flex items-center gap-1.5"
          aria-current="page"
        >
          {icon && (
            <svg class="w-4 h-4">
              <!-- Static icon content -->
            </svg>
          )}
          {xText && <span x-text={xText}></span>}
          <slot />
        </span>
      )}
    </li>
    
    <!-- Separator -->
    {(separator || Astro.slots.has('separator')) && (
      <span class="mx-2 text-muted-foreground flex items-center">
        <slot name="separator">
          {separator === 'chevron' && <ChevronRight class="w-4 h-4" />}
          {separator === 'slash' && <span>/</span>}
          {separator === 'dot' && <span>â€¢</span>}
          {separator === 'arrow' && <ChevronRight class="w-4 h-4" />}
        </slot>
      </span>
    )}
  </div>
)}