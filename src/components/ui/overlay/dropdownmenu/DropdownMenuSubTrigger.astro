---
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '@/lib/utils';
import { ChevronRight } from 'lucide-astro';

const subTriggerVariants = cva(
    'relative flex cursor-default select-none items-center rounded-sm px-3 py-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground',
    {
        variants: {
            disabled: {
                true: 'pointer-events-none opacity-50',
                false: '',
            },
        },
        defaultVariants: {
            disabled: false,
        },
    }
);

export interface Props extends VariantProps<typeof subTriggerVariants> {
    className?: string;
    disabled?: boolean;
    [key: string]: any;
}

const {
    disabled = false,
    className,
    ...alpineProps
} = Astro.props;
---

<div
    x-ref="submenuTrigger"
    data-dropdown-menu-item
    @mouseenter="$el.closest('[x-data]') && ($el.closest('[x-data]').activeIndex = Array.from($el.closest('[role=menu]').querySelectorAll('[data-dropdown-menu-item]')).indexOf($el))"
    :data-active="(typeof activeIndex !== 'undefined' ? activeIndex : -1) === Array.from($el.closest('[role=menu]').querySelectorAll('[data-dropdown-menu-item]')).indexOf($el)"
    :data-state="submenuOpen ? 'open' : 'closed'"
    aria-disabled="${disabled ? 'true' : 'false'}"
    class={cn(
        subTriggerVariants({ disabled }),
        'data-[active=true]:bg-accent data-[active=true]:text-accent-foreground',
        className
    )}
    role="menuitem"
    aria-haspopup="menu"
    :aria-expanded="submenuOpen"
    tabindex="-1"
    {...alpineProps}
>
    <slot />
    <ChevronRight class="ml-auto h-4 w-4" />
</div>